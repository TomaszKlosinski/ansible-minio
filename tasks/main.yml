---

- block:

    - name: "Download minio to {{ minio_server_bin_path }}"
      get_url:
        url: https://dl.minio.io/server/minio/release/linux-amd64/minio
        dest: "{{ minio_server_bin_path }}"
        mode: "0644"

    - name: Create systemd service unit file for minio
      template:
        src: minio.service.j2
        dest: /etc/systemd/system/minio.service
        mode: "0644"
        owner: root
        group: root
      notify: Restart minio

    - name: Create default environment variables file for minio
      template:
        src: minio.j2
        dest: /etc/default/minio
        mode: "0644"
        owner: root
        group: root
      notify: Restart minio

    - name: Start and enable minio
      systemd:
        name: minio
        state: started
        enabled: True
        daemon_reload: True

  tags:
    - minio
